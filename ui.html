<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h1 {
      font-size: 20px;
      margin: 0 0 20px 0;
      color: #333;
    }
    
    .info {
      background: #f0f0f0;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #666;
    }
    
    .option-group {
      margin-bottom: 20px;
    }
    
    .option-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }
    
    .option-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }
    
    .option-group select:focus {
      outline: none;
      border-color: #18a0fb;
    }
    
    .checkbox-group {
      margin-bottom: 20px;
    }
    
    .checkbox-group label {
      display: flex;
      align-items: center;
      font-size: 14px;
      color: #333;
      cursor: pointer;
    }
    
    .checkbox-group input[type="checkbox"] {
      margin-right: 8px;
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
    }
    
    button {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .primary {
      background: #18a0fb;
      color: white;
    }
    
    .primary:hover {
      background: #0d90ea;
    }
    
    .primary:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .secondary {
      background: #e5e5e5;
      color: #333;
    }
    
    .secondary:hover {
      background: #d5d5d5;
    }
    
    .progress {
      display: none;
      margin-top: 20px;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e5e5e5;
      border-radius: 3px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: #18a0fb;
      width: 0%;
      transition: width 0.3s;
    }
    
    .progress-text {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
      text-align: center;
    }
    
    .error {
      color: #ff0000;
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }
    
    .success {
      color: #00a000;
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }
    
    .export-info {
      margin-top: 20px;
      padding: 15px;
      background: #f8f8f8;
      border-radius: 6px;
      display: none;
    }
    
    .export-info h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #333;
    }
    
    .export-list {
      max-height: 200px;
      overflow-y: auto;
      font-size: 12px;
      color: #666;
    }
    
    .export-item {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>图片资源导出工具</h1>
    
    <div class="info">
      <strong>使用说明：</strong><br>
      1. 在Figma中选择包含图片的节点<br>
      2. 选择命名策略（推荐使用"自动添加后缀"）<br>
      3. 点击"开始导出"按钮<br>
      4. 图片将使用完整层级路径命名，用_连接各级节点名<br>
      5. 同名节点会自动添加编号后缀，所有图片导出到同一文件夹
    </div>
    
    <div class="option-group">
      <label for="namingStrategy">图片命名策略：</label>
      <select id="namingStrategy">
        <option value="suffix">层级路径+同名重编号（推荐）</option>
        <option value="id">使用节点ID层级路径</option>
        <option value="merge">简化层级路径</option>
      </select>
    </div>
    
    <div class="checkbox-group">
      <label>
        <input type="checkbox" id="exportAll">
        <span>导出当前页面的所有图片（无需选择节点）</span>
      </label>
    </div>
    
    <div class="button-group">
      <button id="exportBtn" class="primary">开始导出</button>
      <button id="cancelBtn" class="secondary">取消</button>
    </div>
    
    <div class="progress" id="progress">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">正在导出...</div>
    </div>
    
    <div class="error" id="error"></div>
    <div class="success" id="success"></div>
    
    <div class="export-info" id="exportInfo">
      <h3>导出完成</h3>
      <div class="export-list" id="exportList"></div>
    </div>
  </div>
  
  <script>
    const exportBtn = document.getElementById('exportBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const progress = document.getElementById('progress');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const error = document.getElementById('error');
    const success = document.getElementById('success');
    const exportInfo = document.getElementById('exportInfo');
    const exportList = document.getElementById('exportList');
    
    let isExporting = false;
    
    exportBtn.addEventListener('click', () => {
      if (!isExporting) {
        isExporting = true;
        exportBtn.disabled = true;
        error.style.display = 'none';
        success.style.display = 'none';
        exportInfo.style.display = 'none';
        
        const namingStrategy = document.getElementById('namingStrategy').value;
        const exportAll = document.getElementById('exportAll').checked;
        
        parent.postMessage({ 
          pluginMessage: { 
            type: 'export-hierarchy',
            namingStrategy: namingStrategy,
            exportAll: exportAll
          } 
        }, '*');
      }
    });
    
    cancelBtn.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    });
    
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;
      
      if (msg.type === 'error') {
        error.textContent = msg.message;
        error.style.display = 'block';
        exportBtn.disabled = false;
        isExporting = false;
      }
      
      if (msg.type === 'export-start') {
        progress.style.display = 'block';
        progressText.textContent = `正在导出 0/${msg.total} 个节点...`;
      }
      
      if (msg.type === 'export-progress') {
        const percentage = (msg.completed / msg.total) * 100;
        progressFill.style.width = percentage + '%';
        progressText.textContent = `正在导出 ${msg.completed}/${msg.total} 个节点...`;
      }
      
      if (msg.type === 'export-complete') {
        progress.style.display = 'none';
        exportBtn.disabled = false;
        isExporting = false;
        
        if (msg.exports.length > 0) {
          success.textContent = `成功导出 ${msg.exports.length} 个文件`;
          success.style.display = 'block';
          
          exportList.innerHTML = '';
          msg.exports.forEach(exp => {
            const item = document.createElement('div');
            item.className = 'export-item';
            item.textContent = exp.name;
            exportList.appendChild(item);
          });
          
          exportInfo.style.display = 'block';
          
          downloadExports(msg.exports);
        } else {
          error.textContent = '没有可导出的节点';
          error.style.display = 'block';
        }
      }
    };
    
    function downloadExports(exports) {
      if (!exports || exports.length === 0) {
        console.error('No exports to download');
        return;
      }
      
      try {
        const zip = new JSZip();
        
        exports.forEach(exp => {
          if (exp && exp.name && exp.bytes) {
            zip.file(exp.name, exp.bytes);
          }
        });
        
        zip.generateAsync({ type: 'blob' }).then(content => {
          const url = URL.createObjectURL(content);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'figma-hierarchy-export.zip';
          a.click();
          URL.revokeObjectURL(url);
        }).catch(err => {
          console.error('Error generating ZIP:', err);
          error.textContent = '生成ZIP文件时出错';
          error.style.display = 'block';
        });
      } catch (err) {
        console.error('Error in downloadExports:', err);
        error.textContent = '下载出错';
        error.style.display = 'block';
      }
    }
  </script>
  <script>
    // 内联JSZip以避免外部依赖
    !function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.JSZip=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');var support=_dereq_('./support');var nodejsUtils=_dereq_('./nodejsUtils');var GenericWorker=_dereq_('./stream/GenericWorker');module.exports=function(compressionName){var dir=compressionName.toLowerCase().replace(' ','');var file;try{file=_dereq_('./flate')}catch(e){file=_dereq_('./lib/'+dir)}return file}},{"./utils":21,"./support":17,"./nodejsUtils":12,"./stream/GenericWorker":28,"./flate":8,"./lib/":9}],2:[function(_dereq_,module,exports){'use strict';var GenericWorker=_dereq_('../stream/GenericWorker');var utils=_dereq_('../utils');var Crc32Probe=_dereq_('./Crc32Probe');var DataLengthProbe=_dereq_('./DataLengthProbe');function CompressionWorker(compressionName){GenericWorker.call(this,"CompressionWorker");this._compressionName=compressionName.toLowerCase().replace(' ','');this._worker=null;this._createWorker()}utils.inherits(CompressionWorker,GenericWorker);CompressionWorker.prototype._createWorker=function(){var compressionName=this._compressionName;var CompressionObject=_dereq_('../compressions')[compressionName];if(!CompressionObject){throw new Error(compressionName+" is not a valid compression method !")}this._worker=new CompressionObject()};CompressionWorker.prototype.processChunk=function(chunk){this.push({data:this._worker.compress(chunk.data,chunk.meta.percent!==100),meta:chunk.meta})};CompressionWorker.prototype.flush=function(){GenericWorker.prototype.flush.call(this);if(this._worker){this.push({data:this._worker.flush(),meta:{}});this._worker=null}};module.exports=CompressionWorker},{"../stream/GenericWorker":28,"../utils":21,"./Crc32Probe":3,"./DataLengthProbe":4,"../compressions":1}],3:[function(_dereq_,module,exports){'use strict';var GenericWorker=_dereq_('../stream/GenericWorker'),crc32=_dereq_('../crc32');var utils=_dereq_('../utils');function Crc32Probe(){GenericWorker.call(this,"Crc32Probe");this.withStreamInfo("crc32",0)}utils.inherits(Crc32Probe,GenericWorker);Crc32Probe.prototype.processChunk=function(chunk){this.streamInfo.crc32=crc32(chunk.data,this.streamInfo.crc32||0);this.push(chunk)};module.exports=Crc32Probe},{"../stream/GenericWorker":28,"../crc32":5,"../utils":21}],4:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('../utils'),GenericWorker=_dereq_('../stream/GenericWorker');function DataLengthProbe(propName){GenericWorker.call(this,"DataLengthProbe for "+propName);this.propName=propName;this.withStreamInfo(propName,0)}utils.inherits(DataLengthProbe,GenericWorker);DataLengthProbe.prototype.processChunk=function(chunk){if(chunk){this.streamInfo[this.propName]+=chunk.data.length}this.push(chunk)};module.exports=DataLengthProbe},{"../utils":21,"../stream/GenericWorker":28}],5:[function(_dereq_,module,exports){'use strict';var table=[0x00000000,0x77073096,0xEE0E612C,0x990951BA,0x076DC419,0x706AF48F,0xE963A535,0x9E6495A3,0x0EDB8832,0x79DCB8A4,0xE0D5E91E,0x97D2D988,0x09B64C2B,0x7EB17CBD,0xE7B82D07,0x90BF1D91,0x1DB71064,0x6AB020F2,0xF3B97148,0x84BE41DE,0x1ADAD47D,0x6DDDE4EB,0xF4D4B551,0x83D385C7,0x136C9856,0x646BA8C0,0xFD62F97A,0x8A65C9EC,0x14015C4F,0x63066CD9,0xFA0F3D63,0x8D080DF5,0x3B6E20C8,0x4C69105E,0xD56041E4,0xA2677172,0x3C03E4D1,0x4B04D447,0xD20D85FD,0xA50AB56B,0x35B5A8FA,0x42B2986C,0xDBBBC9D6,0xACBCF940,0x32D86CE3,0x45DF5C75,0xDCD60DCF,0xABD13D59,0x26D930AC,0x51DE003A,0xC8D75180,0xBFD06116,0x21B4F4B5,0x56B3C423,0xCFBA9599,0xB8BDA50F,0x2802B89E,0x5F058808,0xC60CD9B2,0xB10BE924,0x2F6F7C87,0x58684C11,0xC1611DAB,0xB6662D3D,0x76DC4190,0x01DB7106,0x98D220BC,0xEFD5102A,0x71B18589,0x06B6B51F,0x9FBFE4A5,0xE8B8D433,0x7807C9A2,0x0F00F934,0x9609A88E,0xE10E9818,0x7F6A0DBB,0x086D3D2D,0x91646C97,0xE6635C01,0x6B6B51F4,0x1C6C6162,0x856530D8,0xF262004E,0x6C0695ED,0x1B01A57B,0x8208F4C1,0xF50FC457,0x65B0D9C6,0x12B7E950,0x8BBEB8EA,0xFCB9887C,0x62DD1DDF,0x15DA2D49,0x8CD37CF3,0xFBD44C65,0x4DB26158,0x3AB551CE,0xA3BC0074,0xD4BB30E2,0x4ADFA541,0x3DD895D7,0xA4D1C46D,0xD3D6F4FB,0x4369E96A,0x346ED9FC,0xAD678846,0xDA60B8D0,0x44042D73,0x33031DE5,0xAA0A4C5F,0xDD0D7CC9,0x5005713C,0x270241AA,0xBE0B1010,0xC90C2086,0x5768B525,0x206F85B3,0xB966D409,0xCE61E49F,0x5EDEF90E,0x29D9C998,0xB0D09822,0xC7D7A8B4,0x59B33D17,0x2EB40D81,0xB7BD5C3B,0xC0BA6CAD,0xEDB88320,0x9ABFB3B6,0x03B6E20C,0x74B1D29A,0xEAD54739,0x9DD277AF,0x04DB2615,0x73DC1683,0xE3630B12,0x94643B84,0x0D6D6A3E,0x7A6A5AA8,0xE40ECF0B,0x9309FF9D,0x0A00AE27,0x7D079EB1,0xF00F9344,0x8708A3D2,0x1E01F268,0x6906C2FE,0xF762575D,0x806567CB,0x196C3671,0x6E6B06E7,0xFED41B76,0x89D32BE0,0x10DA7A5A,0x67DD4ACC,0xF9B9DF6F,0x8EBEEFF9,0x17B7BE43,0x60B08ED5,0xD6D6A3E8,0xA1D1937E,0x38D8C2C4,0x4FDFF252,0xD1BB67F1,0xA6BC5767,0x3FB506DD,0x48B2364B,0xD80D2BDA,0xAF0A1B4C,0x36034AF6,0x41047A60,0xDF60EFC3,0xA867DF55,0x316E8EEF,0x4669BE79,0xCB61B38C,0xBC66831A,0x256FD2A0,0x5268E236,0xCC0C7795,0xBB0B4703,0x220216B9,0x5505262F,0xC5BA3BBE,0xB2BD0B28,0x2BB45A92,0x5CB36A04,0xC2D7FFA7,0xB5D0CF31,0x2CD99E8B,0x5BDEAE1D,0x9B64C2B0,0xEC63F226,0x756AA39C,0x026D930A,0x9C0906A9,0xEB0E363F,0x72076785,0x05005713,0x95BF4A82,0xE2B87A14,0x7BB12BAE,0x0CB61B38,0x92D28E9B,0xE5D5BE0D,0x7CDCEFB7,0x0BDBDF21,0x86D3D2D4,0xF1D4E242,0x68DDB3F8,0x1FDA836E,0x81BE16CD,0xF6B9265B,0x6FB077E1,0x18B74777,0x88085AE6,0xFF0F6A70,0x66063BCA,0x11010B5C,0x8F659EFF,0xF862AE69,0x616BFFD3,0x166CCF45,0xA00AE278,0xD70DD2EE,0x4E048354,0x3903B3C2,0xA7672661,0xD06016F7,0x4969474D,0x3E6E77DB,0xAED16A4A,0xD9D65ADC,0x40DF0B66,0x37D83BF0,0xA9BCAE53,0xDEBB9EC5,0x47B2CF7F,0x30B5FFE9,0xBDBDF21C,0xCABAC28A,0x53B39330,0x24B4A3A6,0xBAD03605,0xCDD70693,0x54DE5729,0x23D967BF,0xB3667A2E,0xC4614AB8,0x5D681B02,0x2A6F2B94,0xB40BBE37,0xC30C8EA1,0x5A05DF1B,0x2D02EF8D];module.exports=function crc32(data,crc){if(typeof crc=="undefined"){crc=0}var x=0;var y=0;var b=0;crc=crc^(-1);for(var i=0,iTop=data.length;i<iTop;i++){b=(crc^data[i])&255;crc=(crc>>>8)^table[b]}return crc^(-1)}},{}],6:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');function DataReader(data){this.data=data;this.length=this.data.length;this.index=0;this.zero=0}DataReader.prototype={checkOffset:function(offset){this.checkIndex(this.index+offset)},checkIndex:function(newIndex){if(this.length<this.zero+newIndex||newIndex<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+(this.zero+newIndex)+"). Corrupted zip ?")}},setIndex:function(newIndex){this.checkIndex(newIndex);this.index=newIndex},skip:function(n){this.setIndex(this.index+n)},byteAt:function(i){return this.data[this.zero+i]},readInt:function(size){var result=0,i;this.checkOffset(size);for(i=this.index+size-1;i>=this.index;i--){result=(result<<8)+this.byteAt(i)}this.index+=size;return result},readString:function(size){return utils.transformTo("string",this.readData(size))},readData:function(size){this.checkOffset(size);if(size===0){return new Uint8Array(0)}var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result},lastIndexOfSignature:function(sig){var sig=utils.transformTo("string",sig);var sigLength=sig.length;var maxSearchLength=Math.min(65558,this.length-sigLength);var index;for(index=maxSearchLength;index>=0;index--){if(utils.transformTo("string",this.readData(sigLength)).indexOf(sig)===0){return this.zero+index}}return-1},readAndCheckSignature:function(sig){var sig=utils.transformTo("string",sig);var data=this.readData(4);return sig===utils.transformTo("string",data)},readDate:function(){var dostime=this.readInt(4);return new Date(Date.UTC((dostime>>25&127)+1980,(dostime>>21&15)-1,dostime>>16&31,dostime>>11&31,dostime>>5&63,(dostime&31)<<1))}};module.exports=DataReader},{"./utils":21}],7:[function(_dereq_,module,exports){'use strict';exports.base64=false;exports.binary=false;exports.dir=false;exports.createFolders=true;exports.date=null;exports.compression=null;exports.compressionOptions=null;exports.comment=null;exports.unixPermissions=null;exports.dosPermissions=null},{}],8:[function(_dereq_,module,exports){'use strict';var USE_TYPEDARRAY=typeof Uint8Array!=='undefined'&&typeof Uint16Array!=='undefined'&&typeof Uint32Array!=='undefined';var pako=_dereq_("pako");var utils=_dereq_("./utils");var strings=_dereq_("./lib/inflate.js");var msg="invalid distance/length or window size";var Z_FIXED=4;var Z_DEFAULT_WINDOWBITS=15;var Z_DEFAULT_LEVEL=6;var Z_DEFAULT_MEMLEVEL=8;var Z_DEFAULT_STRATEGY=0;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var DEF_MEM_LEVEL=8;function Deflater(options){this.options=utils.extend({level:Z_DEFAULT_LEVEL,method:Z_DEFLATED,chunkSize:16*1024,windowBits:Z_DEFAULT_WINDOWBITS,memLevel:Z_DEFAULT_MEMLEVEL,strategy:Z_DEFAULT_STRATEGY,raw:false},options||{});if(this.options.raw&&this.options.windowBits>=0){this.options.windowBits=-this.options.windowBits}else if(this.options.gzip&&this.options.windowBits>=0&&this.options.windowBits<16){this.options.windowBits+=16}this.err=0;this.msg='';this.ended=false;this.chunks=[];this.strm=new pako.Deflate(this.options)}Deflater.prototype.compress=function(input,finalChunk){var err,msg;if(this.ended){return''}if(!input){input=new Uint8Array(0)}if(typeof input==="string"){input=utils.transformTo("uint8array",input)}this.strm.input=input;this.strm.next_in=0;this.strm.avail_in=input.length;var _flush=finalChunk?pako.constants.Z_FINISH:pako.constants.Z_NO_FLUSH;err=pako.deflate(this.strm,_flush);if(err!==pako.constants.Z_STREAM_END&&err!==pako.constants.Z_OK){this.onError(pako.msg);return''}if(this.strm.next_out){if(this.strm.next_out>0){var result=new Uint8Array(this.strm.next_out);result.set(this.strm.output.subarray(0,this.strm.next_out),0);return result}else{return new Uint8Array(0)}}return''};Deflater.prototype.flush=function(){return this.compress(null,true)};Deflater.prototype.onError=function(err){this.err=err};function Inflater(options){this.options=utils.extend({chunkSize:16*1024,windowBits:Z_DEFAULT_WINDOWBITS,raw:false},options||{});if(this.options.raw&&this.options.windowBits>=0){this.options.windowBits=-this.options.windowBits}else if(this.options.gzip&&this.options.windowBits>=0&&this.options.windowBits<16){this.options.windowBits+=16}this.err=0;this.msg='';this.ended=false;this.chunks=[];this.strm=new pako.Inflate(this.options)}Inflater.prototype.decompress=function(input){var err,msg;if(this.ended){return''}if(!input){input=new Uint8Array(0)}if(typeof input==="string"){input=utils.transformTo("uint8array",input)}this.strm.input=input;this.strm.next_in=0;this.strm.avail_in=input.length;err=pako.inflate(this.strm,pako.constants.Z_SYNC_FLUSH);if(err!==pako.constants.Z_STREAM_END&&err!==pako.constants.Z_OK){this.onError(pako.msg);return''}if(this.strm.next_out){if(this.strm.next_out>0){var result=new Uint8Array(this.strm.next_out);result.set(this.strm.output.subarray(0,this.strm.next_out),0);return result}else{return new Uint8Array(0)}}return''};Inflater.prototype.flush=function(){return this.decompress(null)};Inflater.prototype.onError=function(err){this.err=err};function compression(method){if(method==="DEFLATE"){return{compressWorker:function(compressionOptions){return new Deflater(compressionOptions)},uncompressWorker:function(){return new Inflater()}}}else{throw new Error(method+" is not implemented")}}module.exports=compression("DEFLATE")},{"pako":24,"./utils":21,"./lib/inflate.js":10}],9:[function(_dereq_,module,exports){arguments[4][8][0].apply(exports,arguments)},{"pako":24,"./utils":21,"./lib/inflate.js":10,dup:8}],10:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('../utils');var table=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var lengths=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112];var dists=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var MAXBITS=15;var MAXLCODES=286;var MAXDCODES=30;var MAXCODES=MAXLCODES+MAXDCODES+1;var FIXLCODES=288;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var INFLATE_STATE=0;var INFLATE_FAST=1;var inflateStateCheck=function(strm){var state;if(!strm||!strm.state){return 1}state=strm.state;if(strm.total_in!==state.total&&strm.msg!==''){return 1}return 0};var inflateReset=function(strm){var state;if(inflateStateCheck(strm)){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg='';if(state.wrap){strm.adler=state.wrap&1}state.mode=INFLATE_STATE;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(FIXLCODES);state.distcode=state.distdyn=new utils.Buf32(MAXDCODES);state.sane=1;state.back=-1;return Z_OK};var inflateResetKeep=function(strm){var state;if(inflateStateCheck(strm)){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateReset(strm)};var inflateReset2=function(strm,windowBits){var wrap;var state;if(inflateStateCheck(strm)){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateResetKeep(strm)};var inflateInit2=function(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState();strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret};var inflateInit=function(strm){return inflateInit2(strm,15)};var virgin=true;var lenfix,distfix;var fixedtables=function(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5};var InflateState=function(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0};var CODES=0;var LENS=1;var DISTS=2;var inflate_table=function(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lengths;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dists;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>FIXLCODES||type===DISTS&&used>MAXDCODES){return 1}for(;;){here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}left<<=1;curr++}used+=1<<curr;if(type===LENS&&used>FIXLCODES||type===DISTS&&used>MAXDCODES){return 1}low=huff&mask;table[low]=root<<24|curr<<16|(next-table_index)|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0};module.exports=inflate_table},{"../utils":21}],11:[function(_dereq_,module,exports){'use strict';module.exports={2:'need dictionary',5:'stream error',6:'data error',7:'insufficient memory',8:'buffer error','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'}},{}],12:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');function NodejsStreamInputAdapter(filename,stream){this.name=filename||"default";this.stream=stream}NodejsStreamInputAdapter.prototype={resume:function(){return this.stream.resume()},pause:function(){return this.stream.pause()},isPaused:function(){return this.stream.isPaused()},on:function(evt,fn){return this.stream.on(evt,fn)},off:function(evt,fn){return this.stream.removeListener(evt,fn)}};module.exports=NodejsStreamInputAdapter},{"./utils":21}],13:[function(_dereq_,module,exports){'use strict';var Uint8ArrayReader=_dereq_('./uint8ArrayReader');function NodeBufferReader(data){this.data=data;this.length=this.data.length;this.index=0;this.zero=0}NodeBufferReader.prototype=new Uint8ArrayReader();NodeBufferReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result};module.exports=NodeBufferReader},{"./uint8ArrayReader":18}],14:[function(_dereq_,module,exports){'use strict';var support=_dereq_('./support');var utils=_dereq_('./utils');var crc32=_dereq_('./crc32');var signature=_dereq_('./signature');var defaults=_dereq_('./defaults');var base64=_dereq_('./base64');var compressions=_dereq_('./compressions');var CompressedObject=_dereq_('./compressedObject');var nodeBuffer=_dereq_('./lib/nodeBuffer');var utf8=_dereq_('./utf8');var StringWriter=_dereq_('./stringWriter');var Uint8ArrayWriter=_dereq_('./uint8ArrayWriter');var getRawData=function(file){if(file._data instanceof CompressedObject){file._data=file._data.getContent();file.options.binary=true;file.options.base64=false;if(utils.getTypeOf(file._data)==="uint8array"){var copy=file._data;file._data=new Uint8Array(copy.length);if(copy.length!==0){file._data.set(copy,0)}}}return file._data};var getBinaryData=function(file){var result=getRawData(file),type=utils.getTypeOf(result);if(type==="string"){if(!file.options.binary){if(support.nodebuffer){return nodeBuffer(result,"utf-8")}if(support.uint8array){return utils.transformTo("uint8array",result)}}return file.asBinary()}return result};var dataToString=function(asUTF8){var result=getRawData(this);if(result===null||typeof result==="undefined"){return""}if(this.options.base64){result=base64.decode(result)}if(asUTF8&&this.options.binary){result=out.utf8decode(result)}else{result=utils.transformTo("string",result)}if(!asUTF8&&!this.options.binary){result=utils.transformTo("string",out.utf8encode(result))}return result};var ZipObject=function(name,data,options){this.name=name;this.dir=options.dir;this.date=options.date;this.comment=options.comment;this.unixPermissions=options.unixPermissions;this.dosPermissions=options.dosPermissions;this._data=data;this.options=options;this._initialMetadata={dir:options.dir,date:options.date}};ZipObject.prototype={asText:function(){return dataToString.call(this,true)},asBinary:function(){return dataToString.call(this,false)},asNodeBuffer:function(){var result=getBinaryData(this);return utils.transformTo("nodebuffer",result)},asUint8Array:function(){var result=getBinaryData(this);return utils.transformTo("uint8array",result)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var out=module.exports=function JSZip(){if(!(this instanceof JSZip)){return new JSZip()}if(arguments.length){throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.")}this.files={};this.comment=null;this.root="";this.clone=function(){var newObj=new JSZip();for(var i in this){if(typeof this[i]!=="function"){newObj[i]=this[i]}}return newObj}};out.prototype=JSZip.prototype;out.prototype.loadAsync=function(data,options){return external.Promise.resolve(data).then(function(data){return load(this,data,options)}.bind(this))};out.support=support;out.defaults=defaults;out.version="3.10.1";out.loadAsync=function(data,options){return new out().loadAsync(data,options)};out.external=external;var external={Promise:Promise};var load=function(zip,data,options){var files=zip.files;options=utils.extend(defaults,options||{});if(options.base64){data=base64.decode(data)}var zipEntries=external.Promise.resolve(data).then(function(data){return reader(data,options)});return zipEntries.then(function(zipEntries){var promises=[];for(var i=0;i<zipEntries.length;i++){promises.push(loadZipEntry(zip,zipEntries[i],options))}return external.Promise.all(promises)}).then(function(){zip.comment=zipEntries.comment;return zip})};var reader=function(data,options){var type=utils.getTypeOf(data);utils.checkSupport(type);if(options.base64){data=base64.decode(data)}var zipReader=getReader(type,data);var signature=zipReader.lastIndexOfSignature("PK\x05\x06");if(signature<0){throw new Error("Corrupted zip : can't find end of central directory")}zipReader.setIndex(signature);var directoryEnd=readEndOfCentral(zipReader);zipReader.setIndex(directoryEnd.centralDirOffset);var files=[];for(var i=0;i<directoryEnd.diskEntries;i++){var file=readCentralDirectoryEntry(zipReader);file.readLocalFileHeader(zipReader);files.push(file)}return{files:files,comment:directoryEnd.comment}};var getReader=function(type,data){if(type==="nodebuffer"){return new NodeBufferReader(data)}if(type==="uint8array"||type==="array"){return new Uint8ArrayReader(data)}if(type==="string"){return new StringReader(data)}if(type==="arraybuffer"){return new Uint8ArrayReader(new Uint8Array(data))}throw new Error("Unsupported data type")};var loadZipEntry=function(zip,file,options){var compression,decompressed;file.options=options;compression=file.options.compression||null;if(compression){decompressed=new CompressedObject(compression,file.compressedContent,file.uncompressedSize)}else{decompressed=file.compressedContent}zip.files[file.fileRecord.fileName]=new ZipObject(file.fileRecord.fileName,decompressed,{binary:!file.fileRecord.fileName.match(/[^\x00-\x7F]/),optimizedBinaryString:false,base64:false,dir:file.fileRecord.dir,comment:file.fileRecord.fileComment.length?file.fileRecord.fileComment:null,date:file.fileRecord.lastModFileTime,createFolders:options.createFolders,unixPermissions:file.fileRecord.unixPermissions,dosPermissions:file.fileRecord.dosPermissions});return external.Promise.resolve()};var StringReader=_dereq_('./stringReader');var NodeBufferReader=_dereq_('./nodeBufferReader');var Uint8ArrayReader=_dereq_('./uint8ArrayReader');var readEndOfCentral=function(reader){var diskNumber,diskWithCentralDirStart,centralDirRecordsOnThisDisk,centralDirRecords,centralDirSize,centralDirOffset;var zip64ExtensibleDataSector,zip64CentralDirLocator,zip64EndOfCentralDirRecord;if(!reader.readAndCheckSignature("PK\x05\x06")){throw new Error("Invalid or unsupported zip format. No end of central directory record found")}diskNumber=reader.readInt(2);diskWithCentralDirStart=reader.readInt(2);centralDirRecordsOnThisDisk=reader.readInt(2);centralDirRecords=reader.readInt(2);centralDirSize=reader.readInt(4);centralDirOffset=reader.readInt(4);var comment=reader.readData(reader.readInt(2));return{diskNumber:diskNumber,diskWithCentralDirStart:diskWithCentralDirStart,centralDirRecordsOnThisDisk:centralDirRecordsOnThisDisk,centralDirRecords:centralDirRecords,centralDirSize:centralDirSize,centralDirOffset:centralDirOffset,comment:comment}};var readCentralDirectoryEntry=function(reader){var file={};if(!reader.readAndCheckSignature("PK\x01\x02")){throw new Error("Invalid or unsupported zip format. Expected central directory entry")}file.versionMadeBy=reader.readInt(2);file.versionNeeded=reader.readInt(2);file.bitFlag=reader.readInt(2);file.compressionMethod=reader.readInt(2);file.date=reader.readDate();file.crc32=reader.readInt(4);file.compressedSize=reader.readInt(4);file.uncompressedSize=reader.readInt(4);var fileNameLength=reader.readInt(2);var extraFieldLength=reader.readInt(2);var fileCommentLength=reader.readInt(2);var diskNumberStart=reader.readInt(2);var internalFileAttributes=reader.readInt(2);var externalFileAttributes=reader.readInt(4);var relativeOffsetOfLocalHeader=reader.readInt(4);var fileName=reader.readData(fileNameLength);var extraField=reader.readData(extraFieldLength);var fileComment=reader.readData(fileCommentLength);var dir=false;var dosPermissions=null;var unixPermissions=null;if(fileName[fileName.length-1]===utils.transformTo("uint8array","/")[0]){dir=true}if(externalFileAttributes!==0){var dostime=(externalFileAttributes>>>16)&0xFFFF;if(dostime!==0){dosPermissions=dostime}var unixtime=externalFileAttributes&0xFFFF;if(unixtime!==0&&(unixtime&0xF000)!==0){unixPermissions=unixtime}}return{compressedContent:reader.readData(file.compressedSize),uncompressedSize:file.uncompressedSize,crc32:file.crc32,compression:file.compressionMethod,fileRecord:{fileName:utils.transformTo("string",fileName),fileComment:utils.transformTo("string",fileComment),dir:dir,date:file.date,unixPermissions:unixPermissions,dosPermissions:dosPermissions},readLocalFileHeader:function(reader){reader.setIndex(relativeOffsetOfLocalHeader);if(!reader.readAndCheckSignature("PK\x03\x04")){throw new Error("Invalid or unsupported zip format. Expected local file header")}reader.skip(22);var fileNameLength=reader.readInt(2);var extraFieldLength=reader.readInt(2);reader.skip(fileNameLength+extraFieldLength);this.compressedContent=reader.readData(this.fileRecord.compressedSize||file.compressedSize)}}};out.utf8encode=utf8.utf8encode;out.utf8decode=utf8.utf8decode},{"./support":17,"./utils":21,"./crc32":5,"./signature":16,"./defaults":7,"./base64":15,"./compressions":1,"./compressedObject":23,"./lib/nodeBuffer":22,"./utf8":20,"./stringWriter":19,"./uint8ArrayWriter":26,"./stringReader":25,"./nodeBufferReader":13,"./uint8ArrayReader":18}],15:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var InvalidCharacterError=function(message){this.name="InvalidCharacterError";this.message=message};InvalidCharacterError.prototype=new Error;InvalidCharacterError.prototype.constructor=InvalidCharacterError;var polyfill=function(input){var str=String(input).replace(/=+$/,"");if(str.length%4==1){throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.")}for(var bc=0,bs,buffer,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?bs*64+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0){buffer=chars.indexOf(buffer)}return output};var atob=window.atob||polyfill;var btoa=function(input){var str=String(input);for(var block,charCode,idx=0,map=chars,output="";str.charAt(idx|0)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){charCode=str.charCodeAt(idx+=3/4);if(charCode>255){throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}block=block<<8|charCode}return output};var encode=function(input){var type=utils.getTypeOf(input);if(type==="uint8array"){return btoa(utils.transformTo("string",input))}else{return btoa(input)}};var decode=function(input){return utils.transformTo("uint8array",atob(input))};module.exports={encode:encode,decode:decode}},{"./utils":21}],16:[function(_dereq_,module,exports){'use strict';exports.LOCAL_FILE_HEADER="PK\x03\x04";exports.CENTRAL_FILE_HEADER="PK\x01\x02";exports.CENTRAL_DIRECTORY_END="PK\x05\x06";exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07";exports.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06";exports.DATA_DESCRIPTOR="PK\x07\x08"},{}],17:[function(_dereq_,module,exports){'use strict';var nodeBuffer=_dereq_("./lib/nodeBuffer.js");var nodejsUtils=_dereq_("./nodejsUtils.js");exports.base64=true;exports.array=true;exports.string=true;exports.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";exports.nodebuffer=nodeBuffer;exports.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer!=="undefined"){exports.arraybufferview=new Uint8Array(new ArrayBuffer(0)).constructor===Uint8Array}else{exports.arraybufferview=false}exports.blob=typeof Blob!=="undefined"&&function(){try{return new Blob().constructor===Blob}catch(e){return false}}();exports.checkSupport=function(type){var supported=exports[type.toLowerCase()];if(!supported){throw new Error(type+" is not supported by this platform")}};exports.MAX_VALUE_16BITS=65535;exports.MAX_VALUE_32BITS=4294967295},{"./lib/nodeBuffer.js":22,"./nodejsUtils.js":12}],18:[function(_dereq_,module,exports){'use strict';var DataReader=_dereq_('./dataReader');var utils=_dereq_('./utils');function Uint8ArrayReader(data){DataReader.call(this,data)}utils.inherits(Uint8ArrayReader,DataReader);Uint8ArrayReader.prototype.readData=function(size){this.checkOffset(size);if(size===0){return new Uint8Array(0)}var result=this.data.subarray(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result};module.exports=Uint8ArrayReader},{"./dataReader":6,"./utils":21}],19:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');function StringWriter(){this.data=""}StringWriter.prototype={append:function(input){input=utils.transformTo("string",input);this.data+=input},finalize:function(){return this.data}};module.exports=StringWriter},{"./utils":21}],20:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');var support=_dereq_('./support');var nodejsUtils=_dereq_('./nodejsUtils');var GenericWorker=_dereq_('./stream/GenericWorker');var utf8encode=function(str){var bytes,i,len,c;for(bytes=[],i=0,len=str.length;i<len;i++){c=str.charCodeAt(i);if(c>=55296&&c<=56319&&i+1<len){c=(c&1023)<<10;c|=str.charCodeAt(++i)&1023;c+=65536}if(c<=127){bytes.push(c)}else if(c<=2047){bytes.push(192|c>>6,128|c&63)}else if(c<=65535){bytes.push(224|c>>12,128|c>>6&63,128|c&63)}else{bytes.push(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63)}}return bytes};var utf8decode=function(buf){var bytes,i,len,c,c2,c3,c4,out;for(bytes=buf,out="",i=0,len=bytes.length;i<len;){c=bytes[i++];if(c<=127){out+=String.fromCharCode(c)}else if(c>191&&c<224){c2=bytes[i++];out+=String.fromCharCode((c&31)<<6|c2&63)}else if(c>239&&c<248){c2=bytes[i++];c3=bytes[i++];c4=bytes[i++];c=((c&7)<<18|(c2&63)<<12|(c3&63)<<6|c4&63)-65536;out+=String.fromCharCode(55296+(c>>10));out+=String.fromCharCode(56320+(c&1023))}else{c2=bytes[i++];c3=bytes[i++];out+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63)}}return out};module.exports={utf8encode:utf8encode,utf8decode:utf8decode}},{"./utils":21,"./support":17,"./nodejsUtils":12,"./stream/GenericWorker":28}],21:[function(_dereq_,module,exports){'use strict';var support=_dereq_('./support');var base64=_dereq_('./base64');var nodejsUtils=_dereq_('./nodejsUtils');var setImmediate=_dereq_('set-immediate-shim');var external=_dereq_("./external");function string2binary(str){var result=null;for(var i=0;i<str.length;i++){var char=str.charCodeAt(i);if(char>=32768){result="This zip file contains unicode characters, you can't unpack it with the compatibility layer."}}if(result!==null){throw new Error(result)}return str}function arrayBuffer2Uint8array(buffer){return new Uint8Array(buffer)}function uint8array2Uint8array(array){return array}function buffer2Uint8array(buffer){var result=new Uint8Array(buffer.length);for(var i=0;i<result.length;i++){result[i]=buffer[i]}return result}function string2Uint8array(str){return new Uint8Array(string2binary(str).split("").map(function(c){return c.charCodeAt(0)}))}function uint8array2String(array){var result="";for(var i=0;i<array.length;i++){result+=String.fromCharCode(array[i])}return result}function arrayBuffer2String(buffer){return uint8array2String(new Uint8Array(buffer))}function buffer2String(buffer){return uint8array2String(buffer2Uint8array(buffer))}function string2String(s){return s}function uint8array2Buffer(array){return nodejsUtils.newBufferFrom(array)}function arrayBuffer2Buffer(buffer){return uint8array2Buffer(new Uint8Array(buffer))}function buffer2Buffer(buffer){return buffer}function string2Buffer(str){return nodejsUtils.newBufferFrom(string2binary(str),"binary")}var transformTo={string:{string:string2String,array:string2Uint8array,arraybuffer:function(str){return string2Uint8array(str).buffer},uint8array:string2Uint8array,nodebuffer:string2Buffer},array:{string:uint8array2String,array:uint8array2Uint8array,arraybuffer:function(array){return array.buffer},uint8array:uint8array2Uint8array,nodebuffer:uint8array2Buffer},arraybuffer:{string:arrayBuffer2String,array:arrayBuffer2Uint8array,arraybuffer:function(buffer){return buffer},uint8array:arrayBuffer2Uint8array,nodebuffer:arrayBuffer2Buffer},uint8array:{string:uint8array2String,array:uint8array2Uint8array,arraybuffer:function(array){return array.buffer},uint8array:uint8array2Uint8array,nodebuffer:uint8array2Buffer},nodebuffer:{string:buffer2String,array:buffer2Uint8array,arraybuffer:function(buffer){return arrayBuffer2Uint8array(buffer).buffer},uint8array:buffer2Uint8array,nodebuffer:buffer2Buffer}};module.exports={best:support.nodebuffer?"nodebuffer":support.uint8array?"uint8array":"array",array:support.uint8array,nodebuffer:support.nodebuffer,string:true,arraybuffer:support.arraybuffer,transformTo:function(outputType,input){if(!input){input=""}if(!outputType){return input}if(outputType===this.getTypeOf(input)){return input}var result=transformTo[this.getTypeOf(input)][outputType](input);return result},getTypeOf:function(input){if(typeof input==="string"){return"string"}if(Object.prototype.toString.call(input)==="[object Array]"){return"array"}if(support.nodebuffer&&nodejsUtils.isBuffer(input)){return"nodebuffer"}if(support.uint8array&&input instanceof Uint8Array){return"uint8array"}if(support.arraybuffer&&input instanceof ArrayBuffer){return"arraybuffer"}},checkSupport:function(type){var supported=support[type.toLowerCase()];if(!supported){throw new Error(type+" is not supported by this platform")}},MAX_VALUE_16BITS:65535,MAX_VALUE_32BITS:4294967295,pretty:function(str){var res=str.toLowerCase().replace(/ /g,"");if(res==="uint8array"){return"Uint8Array"}else{return res.charAt(0).toUpperCase()+res.slice(1)}},delay:function(callback,args,self){setImmediate(function(){callback.apply(self||null,args||[])})},inherits:function(child,parent){function obj(){}obj.prototype=parent.prototype;child.prototype=new obj},extend:function(){var result={};for(var i=0;i<arguments.length;i++){for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key)&&typeof result[key]==="undefined"){result[key]=arguments[i][key]}}}return result},prepareContent:function(name,inputData,isBinary,isOptimizedBinaryString,isBase64){var promise=external.Promise.resolve(inputData).then(function(data){var isBlob=support.blob&&(data instanceof Blob||['[object File]','[object Blob]'].indexOf(Object.prototype.toString.call(data))!==-1);if(isBlob&&typeof FileReader!=="undefined"){return new external.Promise(function(resolve,reject){var reader=new FileReader;reader.onload=function(e){resolve(e.target.result)};reader.onerror=function(e){reject(e.target.error)};reader.readAsArrayBuffer(data)})}else{return data}});return promise.then(function(data){var dataType=utils.getTypeOf(data);if(dataType==="string"){if(isBase64){data=base64.decode(data)}else if(isBinary&&isOptimizedBinaryString!==true){data=string2binary(data)}}return data})}}},{"./support":17,"./base64":15,"./nodejsUtils":12,"set-immediate-shim":27,"./external":29}],22:[function(_dereq_,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],23:[function(_dereq_,module,exports){'use strict';var external=_dereq_("./external");var DataReader=_dereq_('./dataReader');var DataLengthProbe=_dereq_('./stream/DataLengthProbe');var Crc32Probe=_dereq_('./stream/Crc32Probe');var DataWorker=_dereq_('./stream/DataWorker');var StreamHelper=_dereq_('./stream/StreamHelper');var WorkerRule=_dereq_('./stream/WorkerRule');var ConvertWorker=_dereq_('./stream/ConvertWorker');var Utf8DecodeWorker=_dereq_('./stream/Utf8DecodeWorker');var IDBCursorRequest=_dereq_('./stream/IDBCursorRequest');var utils=_dereq_('./utils');var CompressedObject=function(compressionMethod,data,originalSize,crc32,worker){this.compressedSize=data.length;this.uncompressedSize=originalSize||data.length;this.crc32=crc32||0;this.compression=compressionMethod;this.compressedContent=data.slice?data.slice(0):data};CompressedObject.prototype={getContentWorker:function(){var worker=new DataWorker(utils.transformTo("uint8array",this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new DataLengthProbe("data_length"));var that=this;worker.on("end",function(){if(this.streamInfo.data_length!==that.uncompressedSize){throw new Error("Bug : uncompressed data size mismatch")}});return worker},getCompressedWorker:function(){return new DataWorker(utils.transformTo("uint8array",this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};CompressedObject.prototype.getContent=function(){return this.getContentWorker().accumulate()};module.exports=CompressedObject},{"./external":29,"./dataReader":6,"./stream/DataLengthProbe":4,"./stream/Crc32Probe":3,"./stream/DataWorker":30,"./stream/StreamHelper":31,"./stream/WorkerRule":32,"./stream/ConvertWorker":33,"./stream/Utf8DecodeWorker":34,"./stream/IDBCursorRequest":35,"./utils":21}],24:[function(_dereq_,module,exports){arguments[4][8][0].apply(exports,arguments)},{"pako":36,"./utils":21,"./lib/inflate.js":10,dup:8}],25:[function(_dereq_,module,exports){'use strict';var DataReader=_dereq_('./dataReader');var utils=_dereq_('./utils');function StringReader(data){DataReader.call(this,data)}utils.inherits(StringReader,DataReader);StringReader.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)};StringReader.prototype.lastIndexOfSignature=function(sig){return this.data.lastIndexOf(sig)-this.zero};StringReader.prototype.readAndCheckSignature=function(sig){var sig=this.readData(4);return sig===sig};StringReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result};module.exports=StringReader},{"./dataReader":6,"./utils":21}],26:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./utils');var GenericWorker=_dereq_('./stream/GenericWorker');function Uint8ArrayWriter(){GenericWorker.call(this,"Uint8ArrayWriter");this.data=new Uint8Array(0);this.index=0}utils.inherits(Uint8ArrayWriter,GenericWorker);Uint8ArrayWriter.prototype.processChunk=function(chunk){if(chunk.data.length!==0){var requiredLength=this.data.length+chunk.data.length;if(requiredLength>this.data.length){var newBuffer=new Uint8Array(requiredLength*2);newBuffer.set(this.data,0);this.data=newBuffer}this.data.set(chunk.data,this.index);this.index+=chunk.data.length}this.push(chunk)};Uint8ArrayWriter.prototype.flush=function(){if(this.index>0){var result=this.data.subarray(0,this.index);this.push({data:result,meta:{}})}};Uint8ArrayWriter.prototype.cleanUp=function(){this.data=null};module.exports=Uint8ArrayWriter},{"./utils":21,"./stream/GenericWorker":28}],27:[function(_dereq_,module,exports){(function(global){(function(){var Mutation=global.MutationObserver||global.WebKitMutationObserver;var scheduleDrain;if(process.browser){if(Mutation){scheduleDrain=function(fn){var called=false;var observer=new Mutation(function(){if(!called){called=true;fn()}});var element=document.createElement('div');observer.observe(element,{attributes:true});return function(){element.setAttribute('x','y')}}()}else{scheduleDrain=function(fn){return function(){process.nextTick(fn)}}()}}else{scheduleDrain=function(fn){return function(){process.nextTick(fn)}}()}var called=false;function flushQueue(){if(called){return}called=true;var len=queue.length;for(var i=0;i<len;i+=2){var fn=queue[i];var arg=queue[i+1];fn(arg)}queue.length=0;called=false}var queue=[];function scheduleFlush(){scheduleDrain(flushQueue)}module.exports=scheduleFlush;function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)}module.exports.asap=function asap(fun,thisArg){var len=arguments.length;var args=new Array(len-2);var i=0;while(i<len-2){args[i]=arguments[i+2];i++}queue[queue.length]=new Item(fun,args);if(queue.length===1){scheduleFlush()}}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],28:[function(_dereq_,module,exports){'use strict';function GenericWorker(name){this.name=name||"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=true;this.isFinished=false;this.isLocked=false;this._listeners={data:[],end:[],error:[]};this.previous=null}GenericWorker.prototype={push:function(chunk){this.emit("data",chunk)},end:function(){if(this.isFinished){return false}this.flush();this.isFinished=true;this.emit("end");this.cleanUp();return true},error:function(e){this.isFinished=true;this.generatedError=e;this.emit("error",e);this.previous&&this.previous.error(e);this.cleanUp()},on:function(name,listener){this._listeners[name].push(listener);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(name,arg){if(this._listeners[name]){for(var i=0;i<this._listeners[name].length;i++){this._listeners[name][i].call(this,arg)}}},pipe:function(next){return next.registerPrevious(this)},registerPrevious:function(previous){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.")}this.streamInfo=previous.streamInfo;this.mergeStreamInfo();this.previous=previous;var self=this;previous.on('data',function(chunk){self.processChunk(chunk)});previous.on('end',function(){self.end()});previous.on('error',function(e){self.error(e)});return this},pause:function(){if(!this.isPaused&&!this.isFinished){this.isPaused=true;if(this.previous){this.previous.pause()}}return this},resume:function(){if(!this.isFinished&&this.isPaused){this.isPaused=false;if(this.generatedError){this.error(this.generatedError);return this}if(this.previous){this.previous.resume()}}return this},flush:function(){},processChunk:function(chunk){this.push(chunk)},withStreamInfo:function(key,value){this.extraStreamInfo[key]=value;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var key in this.extraStreamInfo){if(this.extraStreamInfo.hasOwnProperty(key)){this.streamInfo[key]=this.extraStreamInfo[key]}}},lock:function(){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.")}this.isLocked=true;if(this.previous){this.previous.lock()}},toString:function(){var me="Worker "+this.name;if(this.previous){return this.previous+" -> "+me}else{return me}}};module.exports=GenericWorker},{}],29:[function(_dereq_,module,exports){(function(global){module.exports=(global||window).Promise||_dereq_('lie')}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{lie:37}],30:[function(_dereq_,module,exports){'use strict';var GenericWorker=_dereq_('./GenericWorker');var utils=_dereq_('../utils');function DataWorker(data){GenericWorker.call(this,"DataWorker");var self=this;var dataType=utils.getTypeOf(data);if(dataType==="string"){this.dataIsString=true;this.streamInfo.inputType="string"}else{this.dataIsString=false;if(dataType==="arraybuffer"){data=utils.transformTo("uint8array",data)}else{if(utils.getTypeOf(data)!=="uint8array"){throw new Error("Unsupported data type '"+utils.getTypeOf(data)+"'")}}this.streamInfo.inputType="array"}this.data=data}utils.inherits(DataWorker,GenericWorker);DataWorker.prototype.cleanUp=function(){GenericWorker.prototype.cleanUp.call(this);this.data=null};DataWorker.prototype.resume=function(){if(!GenericWorker.prototype.resume.call(this)){return false}if(!this._previousStreamInfo){this._previousStreamInfo=this.streamInfo.inputType!=="string"?this.streamInfo.inputType:"string"}this.resume_:function(){if(this.data!==null){if(this.dataIsString){return this.push({data:this.data,meta:{inputType:"string",percent:100,currentFile:this.streamInfo.currentFile}})}else{if(this.streamInfo.inputType==="string"){this.push({data:utils.transformTo("string",this.data),meta:{inputType:"string",percent:100,currentFile:this.streamInfo.currentFile}})}else{this.push({data:this.data,meta:{inputType:this.streamInfo.inputType||"array",percent:100,currentFile:this.streamInfo.currentFile}})}}}this.end()}()};DataWorker.prototype.processChunk=function(chunk){this.push(chunk)};module.exports=DataWorker},{"./GenericWorker":28,"../utils":21}],31:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('../utils');var ConvertWorker=_dereq_('./ConvertWorker');var GenericWorker=_dereq_('./GenericWorker');var base64=_dereq_('../base64');var support=_dereq_('../support');var external=_dereq_("../external");function StreamHelper(worker,outputType,mimeType){var outputWorker=outputType;switch(outputType){case"blob":case"arraybuffer":outputWorker="uint8array";break;case"base64":outputWorker="string"}try{this._internalType=outputWorker;this._outputType=outputType;this._mimeType=mimeType;utils.checkSupport(outputWorker);this._worker=worker.pipe(new ConvertWorker(outputWorker));worker.lock()}catch(e){this._worker=new GenericWorker("error");this._worker.error(e)}}StreamHelper.prototype={accumulate:function(updateCallback){return this._accumulate(updateCallback)},_accumulate:function(updateCallback){var self=this,worker=this._worker,promise,accumulator=[],total=0;return new external.Promise(function(resolve,reject){var onUpdate,onEnd,onError;worker.on("data",function(data,meta){accumulator.push(data);if(updateCallback){onUpdate(meta)}});worker.on("error",function(err){onError(err)});worker.on("end",function(){onEnd()});worker.resume();onUpdate=function(meta){if(updateCallback){updateCallback(meta)}};onEnd=function(){try{var result=accumulator.length===1?accumulator[0]:utils.transformTo(self._internalType,accumulator);switch(self._outputType){case"blob":result=utils.transformTo("blob",result,self._mimeType);break;case"base64":result=base64.encode(result);break}resolve({data:result,meta:self._worker.streamInfo})}catch(e){reject(e)}accumulator=[]};onError=function(e){reject(e)}})},on:function(evt,fn){var self=this;if(evt==="data"){this._worker.on(evt,function(chunk){fn.call(self,chunk.data,chunk.meta)})}else{this._worker.on(evt,function(){fn.apply(self,arguments)})}return this},resume:function(){utils.delay(this._worker.resume,[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(updateCallback){utils.checkSupport("nodestream");if(this._outputType!=="nodebuffer"){throw new Error(this._outputType+" is not supported by this method")}return new NodejsStreamOutputAdapter(this,{objectMode:this._outputType!=="nodebuffer"},updateCallback)}};module.exports=StreamHelper},{"../utils":21,"./ConvertWorker":33,"./GenericWorker":28,"../base64":15,"../support":17,"../external":29}],32:[function(_dereq_,module,exports){'use strict';function WorkerRule(valueTest,actionDescription,worker){if(utils.isRegExp(valueTest)){this.regex=valueTest}else{this.glob=valueTest}this.action=actionDescription||"";this.worker=worker||null}var utils=_dereq_('../utils');WorkerRule.prototype.shallTransform=function(compression,outputType){return utils.checkWorkerRules(this,compression.toLowerCase(),outputType.toLowerCase())};WorkerRule.prototype.execute=function(compression){return this.worker};module.exports=WorkerRule},{"../utils":21}],33:[function(_dereq_,module,exports){'use strict';var GenericWorker=_dereq_('./GenericWorker');var utils=_dereq_('../utils');function ConvertWorker(destType){GenericWorker.call(this,"ConvertWorker to "+destType);this.destType=destType}utils.inherits(ConvertWorker,GenericWorker);ConvertWorker.prototype.processChunk=function(chunk){this.push({data:utils.transformTo(this.destType,chunk.data),meta:chunk.meta})};module.exports=ConvertWorker},{"./GenericWorker":28,"../utils":21}],34:[function(_dereq_,module,exports){'use strict';var GenericWorker=_dereq_('./GenericWorker');var utils=_dereq_('../utils');function Utf8DecodeWorker(){GenericWorker.call(this,"Utf8DecodeWorker")}utils.inherits(Utf8DecodeWorker,GenericWorker);Utf8DecodeWorker.prototype.processChunk=function(chunk){var data=chunk.data;if(typeof data==="string"){this.push({data:data,meta:chunk.meta})}else{this.push({data:utils.utf8decode(data),meta:chunk.meta})}};module.exports=Utf8DecodeWorker},{"./GenericWorker":28,"../utils":21}],35:[function(_dereq_,module,exports){'use strict';var GenericWorker=_dereq_('./GenericWorker');function IDBCursorRequest(){GenericWorker.call(this,"IDBCursorRequest")}var utils=_dereq_('../utils');utils.inherits(IDBCursorRequest,GenericWorker);IDBCursorRequest.prototype.processChunk=function(chunk){this.push(chunk)};module.exports=IDBCursorRequest},{"./GenericWorker":28,"../utils":21}],36:[function(_dereq_,module,exports){arguments[4][8][0].apply(exports,arguments)},{"pako":38,"./utils":21,"./lib/inflate.js":10,dup:8}],37:[function(_dereq_,module,exports){module.exports=Promise},{}],38:[function(_dereq_,module,exports){arguments[4][8][0].apply(exports,arguments)},{"pako":39,"./utils":21,"./lib/inflate.js":10,dup:8}],39:[function(_dereq_,module,exports){var pako={};pako.deflate=_dereq_('./lib/deflate');pako.inflate=_dereq_('./lib/inflate');pako.constants=_dereq_('./lib/zlib/constants');pako.gzip=function(input,options){return pako.deflate(input,options)};pako.ungzip=function(input,options){return pako.inflate(input,options)};module.exports=pako},{"./lib/deflate":40,"./lib/inflate":41,"./lib/zlib/constants":44}],40:[function(_dereq_,module,exports){'use strict';var zlib_deflate=_dereq_('./zlib/deflate');var utils=_dereq_('./utils/common');var strings=_dereq_('./utils/strings');var msg=_dereq_('./zlib/messages');var ZStream=_dereq_('./zlib/zstream');var toString=Object.prototype.toString;var Z_NO_FLUSH=0;var Z_FINISH=4;var Z_OK=0;var Z_STREAM_END=1;var Z_SYNC_FLUSH=2;var Z_DEFAULT_COMPRESSION=-1;var Z_DEFAULT_STRATEGY=0;var Z_DEFLATED=8;function Deflate(options){if(!(this instanceof Deflate))return new Deflate(options);this.options=utils.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:''},options||{});var opt=this.options;if(opt.raw&&(opt.windowBits>0)){opt.windowBits=-opt.windowBits}else if(opt.gzip&&(opt.windowBits>0)&&(opt.windowBits<16)){opt.windowBits+=16}this.err=0;this.msg='';this.ended=false;this.chunks=[];this.strm=new ZStream;this.strm.avail_out=0;var status=zlib_deflate.deflateInit2(this.strm,opt.level,opt.method,opt.windowBits,opt.memLevel,opt.strategy);if(status!==Z_OK){throw new Error(msg[status])}if(opt.header){zlib_deflate.deflateSetHeader(this.strm,opt.header)}if(opt.dictionary){var dict;if(typeof opt.dictionary==='string'){dict=strings.string2buf(opt.dictionary)}else if(toString.call(opt.dictionary)==='[object ArrayBuffer]'){dict=new Uint8Array(opt.dictionary)}else{dict=opt.dictionary}status=zlib_deflate.deflateSetDictionary(this.strm,dict);if(status!==Z_OK){throw new Error(msg[status])}this._dict_set=true}}Deflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?Z_FINISH:Z_NO_FLUSH;if(typeof data==='string'){strm.input=strings.string2buf(data)}else if(toString.call(data)==='[object ArrayBuffer]'){strm.input=new Uint8Array(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new Uint8Array(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_deflate.deflate(strm,_mode);if(status!==Z_STREAM_END&&status!==Z_OK){this.onError(msg[status]);return false}if(strm.avail_out===0||(strm.avail_in===0&&(_mode===Z_FINISH||_mode===Z_SYNC_FLUSH))){if(this.options.to==='string'){this.onData(strings.buf2binstring(utils.shrinkBuf(strm.output,strm.next_out)))}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}while((strm.avail_in>0||strm.avail_out===0)&&status!==Z_STREAM_END);if(_mode===Z_FINISH){status=zlib_deflate.deflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===Z_OK}if(_mode===Z_SYNC_FLUSH){this.onEnd(Z_OK);strm.avail_out=0;return true}return true};Deflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Deflate.prototype.onEnd=function(status){if(status===Z_OK){if(this.options.to==='string'){this.result=this.chunks.join('')}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function deflate(input,options){var deflator=new Deflate(options);deflator.push(input,true);if(deflator.err){throw new Error(deflator.msg)}return deflator.result}function deflateRaw(input,options){options=options||{};options.raw=true;return deflate(input,options)}function gzip(input,options){options=options||{};options.gzip=true;return deflate(input,options)}exports.Deflate=Deflate;exports.deflate=deflate;exports.deflateRaw=deflateRaw;exports.gzip=gzip},{"./zlib/deflate":48,"./utils/common":46,"./utils/strings":47,"./zlib/messages":43,"./zlib/zstream":45}],41:[function(_dereq_,module,exports){'use strict';var zlib_inflate=_dereq_('./zlib/inflate');var utils=_dereq_('./utils/common');var strings=_dereq_('./utils/strings');var c=_dereq_('./zlib/constants');var msg=_dereq_('./zlib/messages');var ZStream=_dereq_('./zlib/zstream');var GZheader=_dereq_('./zlib/gzheader');var toString=Object.prototype.toString;function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=utils.assign({chunkSize:16384,windowBits:0,to:''},options||{});var opt=this.options;if(opt.raw&&(opt.windowBits>=0)&&(opt.windowBits<16)){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15}}if((opt.windowBits>=0)&&(opt.windowBits<16)&&!(options&&options.windowBits)){opt.windowBits+=32}if((opt.windowBits>15)&&(opt.windowBits<48)){if((opt.windowBits&15)===0){opt.windowBits|=15}}this.err=0;this.msg='';this.ended=false;this.chunks=[];this.strm=new ZStream;this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK){throw new Error(msg[status])}this.header=new GZheader;zlib_inflate.inflateGetHeader(this.strm,this.header)}Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var dictionary=this.options.dictionary;var status,_mode;var next_out_utf8,tail,utf8str;var dict;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;if(typeof data==='string'){strm.input=strings.binstring2buf(data)}else if(toString.call(data)==='[object ArrayBuffer]'){strm.input=new Uint8Array(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new Uint8Array(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH);if(status===c.Z_NEED_DICT&&dictionary){dict=typeof dictionary==='string'?strings.string2buf(dictionary):dictionary;status=zlib_inflate.inflateSetDictionary(this.strm,dict)}if(status===c.Z_BUF_ERROR&&strm.avail_in===0)break;if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onError(msg[status]);return false}if(strm.next_out){if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH)){if(this.options.to==='string'){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail)utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0);this.onData(utf8str)}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}if(strm.avail_in===0&&strm.avail_out===0)break}while((strm.avail_in>0||strm.avail_out===0)&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END){_mode=c.Z_FINISH}if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK}if(_mode===c.Z_SYNC_FLUSH){this.onEnd(c.Z_OK);strm.avail_out=0;return true}return true};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){if(status===c.Z_OK){if(this.options.to==='string'){this.result=this.chunks.join('')}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);if(inflator.err)throw new Error(inflator.msg);return inflator.result}function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options)}exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate},{"./zlib/inflate":50,"./utils/common":46,"./utils/strings":47,"./zlib/constants":44,"./zlib/messages":43,"./zlib/zstream":45,"./zlib/gzheader":49}],42:[function(_dereq_,module,exports){'use strict';function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name='';this.comment='';this.hcrc=0;this.done=false}module.exports=GZheader},{}],43:[function(_dereq_,module,exports){'use strict';module.exports={2:'need dictionary',5:'stream error',6:'data error',7:'insufficient memory',8:'buffer error','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'}},{}],44:[function(_dereq_,module,exports){'use strict';module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(_dereq_,module,exports){'use strict';function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg='';this.state=null;this.data_type=0;this.adler=0}module.exports=ZStream},{}],46:[function(_dereq_,module,exports){'use strict';var TYPED_OK=(typeof Uint8Array!=='undefined')&&(typeof Uint16Array!=='undefined')&&(typeof Int32Array!=='undefined');function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=='object'){throw new TypeError(source+'must be non-object')}for(var p in source){if(_has(source,p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size)return buf;if(buf.subarray)return buf.subarray(0,size);buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],47:[function(_dereq_,module,exports){'use strict';var utils=_dereq_('./common');var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var q=0;q<256;q++){_utf8len[q]=(q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1)}_utf8len[254]=_utf8len[254]=1;exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&0xfc00)===0xd800&&(m_pos+1<str_len)){c2=str.charCodeAt(m_pos+1);if((c2&0xfc00)===0xdc00){c=0x10000+((c&0x03ff)<<10)+(c2&0x03ff);m_pos++}}if(c<0x80){buf_len++}else if(c<0x800){buf_len+=2}else if(c<0x10000){buf_len+=3}else{buf_len+=4}}buf=new utils.Buf8(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&0xfc00)===0xd800&&(m_pos+1<str_len)){c2=str.charCodeAt(m_pos+1);if((c2&0xfc00)===0xdc00){c=0x10000+((c&0x03ff)<<10)+(c2&0x03ff);m_pos++}}if(c<0x80){buf[i++]=c}else if(c<0x800){buf[i++]=0xC0|(c>>>6);buf[i++]=0x80|(c&0x3f)}else if(c<0x10000){buf[i++]=0xE0|(c>>>12);buf[i++]=0x80|(c>>>6&0x3f);buf[i++]=0x80|(c&0x3f)}else{buf[i++]=0xf0|(c>>>18);buf[i++]=0x80|(c>>>12&0x3f);buf[i++]=0x80|(c>>>6&0x3f);buf[i++]=0x80|(c&0x3f)}}return buf};function buf2binstring(buf,len){if(len<65537){if((buf.subarray&&STR_APPLY_UIA_OK)||(buf.length&&STR_APPLY_OK)){return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len))}}var result='';for(var i=0;i<len;i++){result+=String.fromCharCode(buf[i])}return result}exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports.binstring2buf=function(str){var buf=new utils.Buf8(str.length);for(var i=0,len=buf.length;i<len;i++){buf[i]=str.charCodeAt(i)}return buf};exports.buf2string=function(buf,max){var i,out,c,c_len;var len=max||buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<0x80){utf16buf[out++]=c}else{c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=0xfffd;i+=c_len-1;continue}c&=c_len===2?0x1f:c_len===3?0x0f:0x07;while(c_len>1&&i<len){c=(c<<6)|(buf[i++]&0x3f);c_len--}if(c_len>1){utf16buf[out++]=0xfffd;continue}if(c<0x10000){utf16buf[out++]=c}else{c-=0x10000;utf16buf[out++]=0xd800|((c>>10)&0x3ff);utf16buf[out++]=0xdc00|(c&0x3ff)}}}return buf2binstring(utf16buf,out)};exports.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length}pos=max-1;while(pos>=0&&(buf[pos]&0xC0)===0x80){pos--}if(pos<0){return max}if(pos===0){return max}return(pos+_utf8len[buf[pos]]>max)?pos:max}},{"./common":46}],48:[function(_dereq_,module,exports){'use strict';function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg='';this.state=null;this.data_type=0;this.adler=0}module.exports=ZStream},{}],49:[function(_dereq_,module,exports){arguments[4][42][0].apply(exports,arguments)},{dup:42}],50:[function(_dereq_,module,exports){arguments[4][10][0].apply(exports,arguments)},{"../utils":21,dup:10}]},{},[14])(14)});
  </script>
</body>
</html>